---
title: "Music Perception: Stimuli Analysis)"
output: html_notebook
---

- Last checked: `r format(Sys.Date(), "%d-%b-%Y")`

I chose stimuli with the IOIs within 2sd randomly from each condition (teaching, performing), each technique (articulation, dynamics).

Note: SubNr 8 was excluded due to an experimental error, SubNr 16 was excluded due to a deviated tempo (see analysis for [music-teaching: experiment-1](https://github.com/atsukotominaga/music-teaching/tree/main/experiment-1))

# DVs
- IOIs (average tempo)
- Transition points
- CV (tempo variability)
- KOT (articulation)
- KV (dynamics)
- KV-diff (dynamics)

```{r setup, include = FALSE}
if (!require("data.table")) {install.packages("data.table"); require("data.table")}
if (!require("ggplot2")) {install.packages("ggplot2"); require("ggplot2")}
```

```{r file, include = FALSE}
# create a list of data file names
lf_a_t <- list.files("./2sd/art_teaching", pattern = "txt")
lf_a_p <- list.files("./2sd/art_performing", pattern = "txt")
lf_d_t <- list.files("./2sd/dyn_teaching", pattern = "txt")
lf_d_p <- list.files("./2sd/dyn_performing", pattern = "txt")

# merge all data files into one
data <- data.table()
for (i in 1:length(lf_a_t)){
 data_i <- fread(file.path("./2sd/art_teaching", lf_a_t[i]), header = T, sep = ",", dec = ".")
 data_i$Instance <- i
 data <- rbind(data, data_i)
}
for (i in 1:length(lf_a_p)){
 data_i <- fread(file.path("./2sd/art_performing", lf_a_p[i]), header = T, sep = ",", dec = ".")
 data_i$Instance <- i
 data <- rbind(data, data_i)
}
for (i in 1:length(lf_d_t)){
 data_i <- fread(file.path("./2sd/dyn_teaching", lf_d_t[i]), header = T, sep = ",", dec = ".")
 data_i$Instance <- i
 data <- rbind(data, data_i)
}
for (i in 1:length(lf_d_p)){
 data_i <- fread(file.path("./2sd/dyn_performing", lf_d_p[i]), header = T, sep = ",", dec = ".")
 data_i$Instance <- i
 data <- rbind(data, data_i)
}

# define subcomponents
# For intervals
ls_legato <- list(c(1:7), c(17:23), c(42:48), c(58:64))
ls_staccato <- list(c(9:15), c(25:31), c(34:40), c(50:56))
ls_forte <- list(c(1:7), c(17:23), c(42:48), c(58:64))
ls_piano <- list(c(9:15), c(25:31), c(34:40), c(50:56))

# For each note (velocity only)
ls_legato_2 <- list(c(1:8), c(17:24), c(42:49), c(58:65))
ls_staccato_2 <- list(c(9:16), c(25:32), c(34:41), c(50:57))
ls_forte_2 <- list(c(1:8), c(17:24), c(42:49), c(58:65))
ls_piano_2 <- list(c(9:16), c(25:32), c(34:41), c(50:57))

# Define Skill Change (LtoS, FtoP)
change_1 <- c(8, 24, 49)
# Define Skill Change (StoL, PtoF)
change_2 <- c(16, 41, 57)
```

# IOIs
```{r ioi, include = FALSE}
data_onset <- data[Key_OnOff == 1]
data_offset <- data[Key_OnOff == 0]

data_onset$IOI <- diff(c(0, data_onset$TimeStamp))
dt_ioi <- data_onset[NoteNr != 17]
dt_ioi$Interval <- rep(1:66, nrow(dt_ioi)/66)

# assign Subcomponents
dt_ioi$Subcomponent <- "NA"
# Legato
for (phrase in 1:length(ls_legato)){
 for (note in 1:length(ls_legato[[phrase]])){
   dt_ioi[Skill == "articulation" & Interval == ls_legato[[phrase]][note]]$Subcomponent <- "Legato"
 }
}
# Staccato
for (phrase in 1:length(ls_staccato)){
 for (note in 1:length(ls_staccato[[phrase]])){
   dt_ioi[Skill == "articulation" & Interval == ls_staccato[[phrase]][note]]$Subcomponent <- "Staccato"
 }
}

# Forte
for (phrase in 1:length(ls_forte)){
 for (note in 1:length(ls_forte[[phrase]])){
   dt_ioi[Skill == "dynamics" & Interval == ls_forte[[phrase]][note]]$Subcomponent <- "Forte"
 }
}
# Piano
for (phrase in 1:length(ls_piano)){
 for (note in 1:length(ls_piano[[phrase]])){
   dt_ioi[Skill == "dynamics" & Interval == ls_piano[[phrase]][note]]$Subcomponent <- "Piano"
 }
}

# assign Subcomponent Change
for (number in change_1){
 dt_ioi[Skill == "articulation" & Interval == number]$Subcomponent <- "LtoS"
 dt_ioi[Skill == "dynamics" & Interval == number]$Subcomponent <- "FtoP"
}
for (number in change_2){
 dt_ioi[Skill == "articulation" & Interval == number]$Subcomponent <- "StoL"
 dt_ioi[Skill == "dynamics" & Interval == number]$Subcomponent <- "PtoF"
}

ioi <- dt_ioi[Subcomponent != "NA", .(N = .N, Mean = mean(IOI), SD = sd(IOI)), by = .(Instance, Condition, Skill)]
ioi_art <- ioi[Skill == "articulation", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Condition, Skill)]
ioi_dyn <- ioi[Skill == "dynamics", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Condition, Skill)]
```

## 1. All
## Each instance
```{r ioi_stats_ind, echo = FALSE}
ioi
```

## Averaged
```{r ioi_stats_all, echo = FALSE}
ioi_art
ioi_dyn
```

## Plots
### Articulation
```{r ioi_art_plot, echo = FALSE}
p_ioi_art_t <- ggplot(ioi[Skill == "articulation" & Condition == "teaching"], aes(x = Instance, y = Mean)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
               width = .2, position = position_dodge(.9)) +
 geom_hline(yintercept = 188, linetype = "dashed") +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "IOI (ms)", subtitle = "IOI: Each instance (Articulation-Teaching)")
p_ioi_art_t

p_ioi_art_p <- ggplot(ioi[Skill == "articulation" & Condition == "performing"], aes(x = Instance, y = Mean)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
               width = .2, position = position_dodge(.9)) +
 geom_hline(yintercept = 188, linetype = "dashed") +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "IOI (ms)", subtitle = "IOI: Each instance (Articulation-Performing)")
p_ioi_art_p

p_ioi_art_all <- ggplot(ioi_art, aes(x = Skill, y = Mean, fill = Condition)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   geom_hline(yintercept = 188, linetype = "dashed") +
   labs(y = "IOI (ms)", subtitle = "IOI: Averaged (Articulation)")
p_ioi_art_all
```
### Dynamics
```{r ioi_dyn_plot, echo = FALSE}
p_ioi_dyn_t <- ggplot(ioi[Skill == "dynamics" & Condition == "teaching"], aes(x = Instance, y = Mean)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
               width = .2, position = position_dodge(.9)) +
 geom_hline(yintercept = 188, linetype = "dashed") +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "IOI (ms)", subtitle = "IOI: Each instance (Dynamics)")
p_ioi_dyn_t

p_ioi_dyn_p <- ggplot(ioi[Skill == "dynamics" & Condition == "performing"], aes(x = Instance, y = Mean)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
               width = .2, position = position_dodge(.9)) +
 geom_hline(yintercept = 188, linetype = "dashed") +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "IOI (ms)", subtitle = "IOI: Each instance (Dynamics)")
p_ioi_dyn_p

p_ioi_dyn_all <- ggplot(ioi_dyn, aes(x = Skill, y = Mean, fill = Condition)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   geom_hline(yintercept = 188, linetype = "dashed") +
   labs(y = "IOI (ms)", subtitle = "IOI: Averaged (Dynamics)")
p_ioi_dyn_all
```


## 2. Transition points
## Each instance
```{r transition, echo = FALSE}
ioi_tra <- dt_ioi[Subcomponent == "LtoS" | Subcomponent == "StoL" | Subcomponent == "FtoP" | Subcomponent == "PtoF", .(N = .N, Mean = mean(IOI), SD = sd(IOI)), by = .(Instance, Condition, Skill)]
ioi_tra

ioi_tra_art <- ioi_tra[Skill == "articulation", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Condition, Skill)]
ioi_tra_dyn <- ioi_tra[Skill == "dynamics", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Condition, Skill)]
```

## Averaged
```{r transition-tats_all, echo = FALSE}

ioi_tra_art
ioi_tra_dyn
```

## Plots
### Articulation
```{r ioi_tra_art_plot, echo = FALSE}
p_ioi_tra_art_t <- ggplot(ioi_tra[Skill == "articulation" & Condition == "teaching"], aes(x = Instance, y = Mean)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
               width = .2, position = position_dodge(.9)) +
 geom_hline(yintercept = 188, linetype = "dashed") +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "IOI (ms)", subtitle = "IOI-Transition: Each instance (Articulation-Teaching)")
p_ioi_tra_art_t

p_ioi_tra_art_p <- ggplot(ioi_tra[Skill == "articulation" & Condition == "performing"], aes(x = Instance, y = Mean)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
               width = .2, position = position_dodge(.9)) +
 geom_hline(yintercept = 188, linetype = "dashed") +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "IOI (ms)", subtitle = "IOI-Transition: Each instance (Articulation-Performing)")
p_ioi_tra_art_p

p_ioi_tra_art_all <- ggplot(ioi_tra_art, aes(x = Skill, y = Mean, fill = Condition)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   geom_hline(yintercept = 188, linetype = "dashed") +
   labs(y = "IOI (ms)", subtitle = "IOI-Transition: Averaged (Articulation)")
p_ioi_tra_art_all
```

### Dynamics
```{r ioi_tra_dyn_plot, echo = FALSE}
p_ioi_tra_dyn_t <- ggplot(ioi_tra[Skill == "dynamics" & Condition == "teaching"], aes(x = Instance, y = Mean)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
               width = .2, position = position_dodge(.9)) +
 geom_hline(yintercept = 188, linetype = "dashed") +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "IOI (ms)", subtitle = "IOI-Transition: Each instance (Dynamics)")
p_ioi_tra_dyn_t

p_ioi_tra_dyn_p <- ggplot(ioi_tra[Skill == "dynamics" & Condition == "performing"], aes(x = Instance, y = Mean)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
               width = .2, position = position_dodge(.9)) +
 geom_hline(yintercept = 188, linetype = "dashed") +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "IOI (ms)", subtitle = "IOI-Transition: Each instance (Dynamics)")
p_ioi_tra_dyn_p

p_ioi_tra_dyn_all <- ggplot(ioi_tra_dyn, aes(x = Skill, y = Mean, fill = Condition)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   geom_hline(yintercept = 188, linetype = "dashed") +
   labs(y = "IOI (ms)", subtitle = "IOI-Transition: Averaged (Dynamics)")
p_ioi_tra_dyn_all
```

## 3. CV
## Each instance
```{r cv, echo = FALSE}
ioi_cv <- ioi
ioi_cv$CV <- 0
for (cond in unique(dt_ioi$Condition)){
   for (tech in unique(dt_ioi$Skill)){
      for (i in 1:24){
         current <- dt_ioi[Condition == cond & Skill == tech & Instance == i]
         current_cv <- sd(current$IOI)/ioi[Condition == cond & Skill == tech & Instance == i]$Mean
         ioi_cv[Condition == cond & Skill == tech & Instance == i]$CV <- current_cv
      }
   }
}
ioi_cv
ioi_cv_art <- ioi_cv[Skill == "articulation", .(N = .N, Mean = mean(CV), SD = sd(CV)), by = .(Condition, Skill)]
ioi_cv_dyn <- ioi_cv[Skill == "dynamics", .(N = .N, Mean = mean(CV), SD = sd(CV)), by = .(Condition, Skill)]
```

## Averaged
```{r ioi_cv_stats_all, echo = FALSE}
ioi_cv_art
ioi_cv_dyn
```

## Plots
### Articulation
```{r ioi_cv_art_plot, echo = FALSE}
p_ioi_cv_art_t <- ggplot(ioi_cv[Skill == "articulation" & Condition == "teaching"], aes(x = Instance, y = CV)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "CV", subtitle = "IOI-CV: Each instance (Articulation-Teaching)")
p_ioi_cv_art_t

p_ioi_cv_art_p <- ggplot(ioi_cv[Skill == "articulation" & Condition == "performing"], aes(x = Instance, y = CV)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "CV", subtitle = "IOI-CV: Each instance (Articulation-Performing)")
p_ioi_cv_art_p

p_ioi_cv_art_all <- ggplot(ioi_cv_art, aes(x = Skill, y = Mean, fill = Condition)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   labs(y = "CV", subtitle = "IOI-CV: Averaged (Articulation)")
p_ioi_cv_art_all
```

### Dynamics
```{r ioi_cv_dyn_plot, echo = FALSE}
p_ioi_cv_dyn_t <- ggplot(ioi_cv[Skill == "dynamics" & Condition == "teaching"], aes(x = Instance, y = CV)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "CV", subtitle = "IOI-CV: Each instance (Dynamics)")
p_ioi_cv_dyn_t

p_ioi_cv_dyn_p <- ggplot(ioi_cv[Skill == "dynamics" & Condition == "performing"], aes(x = Instance, y = CV)) +
 geom_bar(stat = "identity", position = position_dodge()) +
 scale_x_continuous(breaks = seq(1:24)) +
 labs(y = "CV", subtitle = "IOI-CV: Each instance (Dynamics)")
p_ioi_cv_dyn_p

p_ioi_cv_dyn_all <- ggplot(ioi_cv_dyn, aes(x = Skill, y = Mean, fill = Condition)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   labs(y = "CV", subtitle = "IOI-CV: Averaged (Dynamics)")
p_ioi_cv_dyn_all
```

# KOT (only for articulation stimuli)
```{r kot, include = FALSE}
data_onset$KOT <- NA
for (row in 1:nrow(data_onset)){
   if (row < nrow(data_onset)){
      data_onset$KOT[row+1] <- data_offset$TimeStamp[row] - data_onset$TimeStamp[row+1] # offset(n) - onset(n+1)
   }
}

dt_kot <- data_onset[NoteNr != 17]
dt_kot$Interval <- rep(1:66, nrow(dt_kot)/66)

# assign Subcomponents
dt_kot$Subcomponent <- "NA"
# Legato
for (phrase in 1:length(ls_legato)){
   for (note in 1:length(ls_legato[[phrase]])){
     dt_kot[Skill == "articulation" & Interval == ls_legato[[phrase]][note]]$Subcomponent <- "Legato"
   }
}
# Staccato
for (phrase in 1:length(ls_staccato)){
   for (note in 1:length(ls_staccato[[phrase]])){
     dt_kot[Skill == "articulation" & Interval == ls_staccato[[phrase]][note]]$Subcomponent <- "Staccato"
   }
}

# Forte
for (phrase in 1:length(ls_forte)){
   for (note in 1:length(ls_forte[[phrase]])){
     dt_kot[Skill == "dynamics" & Interval == ls_forte[[phrase]][note]]$Subcomponent <- "Forte"
   }
}
# Piano
for (phrase in 1:length(ls_piano)){
   for (note in 1:length(ls_piano[[phrase]])){
     dt_kot[Skill == "dynamics" & Interval == ls_piano[[phrase]][note]]$Subcomponent <- "Piano"
   }
}

# assign Subcomponent Change
for (number in change_1){
   dt_kot[Skill == "articulation" & Interval == number]$Subcomponent <- "LtoS"
   dt_kot[Skill == "dynamics" & Interval == number]$Subcomponent <- "FtoP"
}
for (number in change_2){
   dt_kot[Skill == "articulation" & Interval == number]$Subcomponent <- "StoL"
   dt_kot[Skill == "dynamics" & Interval == number]$Subcomponent <- "PtoF"
}

kot <- dt_kot[Subcomponent == "Legato" | Subcomponent == "Staccato", .(N = .N, Mean = mean(KOT), SD = sd(KOT)), by = .(Instance, Condition, Skill, Subcomponent)]
kot_all <- kot[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Condition, Skill, Subcomponent)]
```

## Each instance
```{r kot_stats_ind, echo = FALSE}
kot
```

## Averaged
```{r kot_stats_all, echo = FALSE}
kot_all
```

## Plots
```{r kot_plot, echo = FALSE}
p_kot_a <- ggplot(kot[Condition == "teaching"], aes(x = Instance, y = Mean)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   facet_grid(Subcomponent ~ .) + scale_x_continuous(breaks = seq(1:24)) +
   labs(y = "KOT (ms)", subtitle = "KOT: Each instance (Articulation-Teaching)")
p_kot_a

p_kot_d <- ggplot(kot[Condition == "performing"], aes(x = Instance, y = Mean)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   facet_grid(Subcomponent ~ .) + scale_x_continuous(breaks = seq(1:24)) +
   labs(y = "KOT (ms)", subtitle = "KOT: Each instance (Articulation-Performing)")
p_kot_d

p_kot_all <- ggplot(kot_all, aes(x = Subcomponent, y = Mean, fill = Condition)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   labs(y = "KOT (ms)", subtitle = "KOT: Averaged (Articulation)")
p_kot_all
```

# KV (only for dynamics stimuli)
```{r kv, include = FALSE}
dt_vel <- data_onset
dt_vel$Note <- rep(1:67, nrow(dt_vel)/67)

# assign Subcomponents
# for each note
dt_vel$Subcomponent <- NA
# Legato
for (phrase in 1:length(ls_legato_2)){
   for (note in 1:length(ls_legato_2[[phrase]])){
     dt_vel$Subcomponent[dt_vel$Skill == "articulation" & dt_vel$Note == ls_legato_2[[phrase]][note]] <- "Legato"
   }
}
# Staccato
for (phrase in 1:length(ls_staccato_2)){
   for (note in 1:length(ls_staccato_2[[phrase]])){
     dt_vel$Subcomponent[dt_vel$Skill == "articulation" & dt_vel$Note == ls_staccato_2[[phrase]][note]] <- "Staccato"
   }
}

# Forte
for (phrase in 1:length(ls_forte_2)){
   for (note in 1:length(ls_forte_2[[phrase]])){
     dt_vel$Subcomponent[dt_vel$Skill == "dynamics" & dt_vel$Note == ls_forte_2[[phrase]][note]] <- "Forte"
   }
}

# Piano
for (phrase in 1:length(ls_piano_2)){
   for (note in 1:length(ls_piano_2[[phrase]])){
     dt_vel$Subcomponent[dt_vel$Skill == "dynamics" & dt_vel$Note == ls_piano_2[[phrase]][note]] <- "Piano"
   }
}

vel <- dt_vel[Subcomponent == "Forte" | Subcomponent == "Piano", .(N = .N, Mean = mean(Velocity), SD = sd(Velocity)), by = .(Instance, Condition, Skill, Subcomponent)]
vel_all <- vel[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Condition, Skill, Subcomponent)]
```

## Each instance
```{r vel_stats_ind, echo = FALSE}
vel
```

## Averaged
```{r vel_stats_all, echo = FALSE}
vel_all
```

## Plots
```{r vel_plot, echo = FALSE}
p_vel_t <- ggplot(vel[Condition == "teaching"], aes(x = Instance, y = Mean)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   facet_grid(Subcomponent ~ .) + scale_x_continuous(breaks = seq(1:24)) +
   labs(y = "Key Velocity", subtitle = "KV: Each instance (Dynamics-Teaching)")
p_vel_t

p_vel_p <- ggplot(vel[Condition == "performing"], aes(x = Instance, y = Mean)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   facet_grid(Subcomponent ~ .) + scale_x_continuous(breaks = seq(1:24)) +
   labs(y = "Key Velocity", subtitle = "KV: Each instance (Dynamics-Performing)")
p_vel_p

p_vel_all <- ggplot(vel_all, aes(x = Subcomponent, y = Mean, fill = Condition)) +
   geom_bar(stat = "identity", position = position_dodge()) +
   geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                 width = .2, position = position_dodge(.9)) +
   labs(y = "Key Velocity", subtitle = "KV: Averaged (Dynamics)")
p_vel_all
```

# KV-Diff (only for dynamics stimuli)
```{r vel_diff, include = FALSE}
# calculate differences and remove the first note
dt_vel$Diff <- diff(c(0, dt_vel$Velocity))
dt_vel_diff <- dt_vel[Note != 1]
dt_vel$Diff <- NULL # remove Diff from dt_vel

# assign Interval
dt_vel_diff$Interval <- rep(1:66, nrow(dt_vel_diff)/66)

# assign Subcomponents
# for intervals
dt_vel_diff$Subcomponent <- NA
# Legato
for (phrase in 1:length(ls_legato)){
for (note in 1:length(ls_legato[[phrase]])){
  dt_vel_diff$Subcomponent[dt_vel_diff$Skill == "articulation" & dt_vel_diff$Interval == ls_legato[[phrase]][note]] <- "Legato"
}
}
# Staccato
for (phrase in 1:length(ls_staccato)){
for (note in 1:length(ls_staccato[[phrase]])){
  dt_vel_diff$Subcomponent[dt_vel_diff$Skill == "articulation" & dt_vel_diff$Interval == ls_staccato[[phrase]][note]] <- "Staccato"
}
}

# Forte
for (phrase in 1:length(ls_forte)){
for (note in 1:length(ls_forte[[phrase]])){
  dt_vel_diff$Subcomponent[dt_vel_diff$Skill == "dynamics" & dt_vel_diff$Interval == ls_forte[[phrase]][note]] <- "Forte"
}
}
# Piano
for (phrase in 1:length(ls_piano)){
for (note in 1:length(ls_piano[[phrase]])){
  dt_vel_diff$Subcomponent[dt_vel_diff$Skill == "dynamics" & dt_vel_diff$Interval == ls_piano[[phrase]][note]] <- "Piano"
}
}

# Assign Skill Change
for (i in change_1){
dt_vel_diff$Subcomponent[dt_vel_diff$Skill == "articulation" & dt_vel_diff$Interval == i] <- "LtoS"
dt_vel_diff$Subcomponent[dt_vel_diff$Skill == "dynamics" & dt_vel_diff$Interval == i] <- "FtoP"
}
for (i in change_2){
dt_vel_diff$Subcomponent[dt_vel_diff$Skill == "articulation" & dt_vel_diff$Interval == i] <- "StoL"
dt_vel_diff$Subcomponent[dt_vel_diff$Skill == "dynamics" & dt_vel_diff$Interval == i] <- "PtoF"
}

vel_diff <- dt_vel_diff[Subcomponent == "FtoP" | Subcomponent == "PtoF", .(N = .N, Mean = mean(Diff), SD = sd(Diff)), by = .(Instance, Condition, Skill, Subcomponent)]
vel_diff_all <- vel_diff[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Condition, Skill, Subcomponent)]
```

## Each instance
```{r vel__diff_stats_ind, echo = FALSE}
vel_diff
```

## Averaged
```{r vel_diff_stats_all, echo = FALSE}
vel_diff_all
```

## Plots
```{r vel_diff_plot, echo = FALSE}
p_vel_diff_t <- ggplot(vel_diff[Condition == "teaching"], aes(x = Instance, y = Mean)) +
geom_bar(stat = "identity", position = position_dodge()) +
geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
              width = .2, position = position_dodge(.9)) +
facet_grid(Subcomponent ~ .) + scale_x_continuous(breaks = seq(1:24)) +
labs(y = "KV difference", subtitle = "KV-Diff: Each instance (Dynamics)")
p_vel_diff_t

p_vel_diff_p <- ggplot(vel_diff[Condition == "performing"], aes(x = Instance, y = Mean)) +
geom_bar(stat = "identity", position = position_dodge()) +
geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
              width = .2, position = position_dodge(.9)) +
facet_grid(Subcomponent ~ .) + scale_x_continuous(breaks = seq(1:24)) +
labs(y = "KV difference", subtitle = "KV-Diff: Each instance (Dynamics)")
p_vel_diff_p

p_vel_diff_all <- ggplot(vel_diff_all, aes(x = Subcomponent, y = Mean, fill = Condition)) +
geom_bar(stat = "identity", position = position_dodge()) +
geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
              width = .2, position = position_dodge(.9)) +
labs(y = "KV difference", subtitle = "KV-Diff: Averaged (Dynamics)")
p_vel_diff_all
```

# Pilot data (with 9 participants)
```{r read-2, include = FALSE}
order_data <- fread("../../../analysis/order_data.txt")
```

I order stimuli above by participants' performance (left: low accuracy - high: high accuracy).

- dashed lines indicate a target tempo

## 1. Tempo
### All IOIs (articulation)
```{r ioi-articulation, echo = FALSE}
# ioi-articulation
ioi_articulation <- ioi[Skill == "articulation"]
order_art <- order_data[technique == "articulation"]
order_art <- order_art[order(condition, item)]

ioi_articulation$Correct <- 0
ioi_articulation[Condition == "teaching"]$Correct <- order_art[condition == "teaching"]$mean_percent
ioi_articulation[Condition == "performing"]$Correct <- order_art[condition == "performing"]$mean_percent

ggplot(ioi_articulation[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 250) +
 geom_hline(yintercept = 188, linetype = "dashed") + labs(x = "Stimuli", y = "IOI (ms)", subtitle = "Teaching-Articulation (Correct Answer = YES)")

ggplot(ioi_articulation[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 250) +
 geom_hline(yintercept = 188, linetype = "dashed") + labs(x = "Stimuli", y = "IOI (ms)", subtitle = "Performing-Articulation (Correct Answer = NO)")
```

### All IOIs (dynamics)
```{r ioi-dynamics, echo = FALSE}
# ioi-dynamics
ioi_dynamics <- ioi[Skill == "dynamics"]
order_dyn <- order_data[technique == "dynamics"]
order_dyn <- order_dyn[order(condition, item)]

ioi_dynamics$Correct <- 0
ioi_dynamics[Condition == "teaching"]$Correct <- order_art[condition == "teaching"]$mean_percent
ioi_dynamics[Condition == "performing"]$Correct <- order_art[condition == "performing"]$mean_percent

ggplot(ioi_dynamics[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 300) +
 geom_hline(yintercept = 188, linetype = "dashed") + labs(x = "Stimuli", y = "IOI (ms)", subtitle = "Teaching-Dynamics (Correct Answer = YES)")

ggplot(ioi_dynamics[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 300) +
 geom_hline(yintercept = 188, linetype = "dashed") + labs(x = "Stimuli", y = "IOI (ms)", subtitle = "Performing-Dynamics (Correct Answer = NO)")
```

### Transition (articulation)
```{r ioi-tra-articulation, echo = FALSE}
# ioi-tra-articulation
ioi_tra_articulation <- ioi_tra[Skill == "articulation"]

ioi_tra_articulation$Correct <- 0
ioi_tra_articulation[Condition == "teaching"]$Correct <- order_art[condition == "teaching"]$mean_percent
ioi_tra_articulation[Condition == "performing"]$Correct <- order_art[condition == "performing"]$mean_percent

ggplot(ioi_tra_articulation[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 300) +
 geom_hline(yintercept = 188, linetype = "dashed") + labs(x = "Stimuli", y = "IOI (ms)", subtitle = "Teaching-Articulation (Correct Answer = YES)")

ggplot(ioi_tra_articulation[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 300) +
 geom_hline(yintercept = 188, linetype = "dashed") + labs(x = "Stimuli", y = "IOI (ms)", subtitle = "Performing-Articulation (Correct Answer = NO)")
```

### Transition (dynamics)
```{r ioi-tra-dynamics, echo = FALSE}
# ioi-tra-dynamics
ioi_tra_dynamics <- ioi_tra[Skill == "dynamics"]

ioi_tra_dynamics$Correct <- 0
ioi_tra_dynamics[Condition == "teaching"]$Correct <- order_art[condition == "teaching"]$mean_percent
ioi_tra_dynamics[Condition == "performing"]$Correct <- order_art[condition == "performing"]$mean_percent

ggplot(ioi_tra_dynamics[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 350) +
 geom_hline(yintercept = 188, linetype = "dashed") + labs(x = "Stimuli", y = "IOI (ms)", subtitle = "Teaching-Articulation (Correct Answer = YES)")

ggplot(ioi_tra_dynamics[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 350) +
 geom_hline(yintercept = 188, linetype = "dashed") + labs(x = "Stimuli", y = "IOI (ms)", subtitle = "Performing-Articulation (Correct Answer = NO)")
```

### CV(articulation)
```{r ioi-cv-articulation, echo = FALSE}
# ioi-tra-articulation
ioi_cv_articulation <- ioi_cv[Skill == "articulation"]

ioi_cv_articulation$Correct <- 0
ioi_cv_articulation[Condition == "teaching"]$Correct <- order_art[condition == "teaching"]$mean_percent
ioi_cv_articulation[Condition == "performing"]$Correct <- order_art[condition == "performing"]$mean_percent

ggplot(ioi_cv_articulation[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = CV, fill = Correct)) + geom_bar(stat = "identity") + labs(x = "Stimuli", y = "CV", subtitle = "Teaching-Articulation (Correct Answer = YES)")

ggplot(ioi_cv_articulation[Condition == "performing"], aes(x = reorder(Instance, Correct), y = CV, fill = Correct)) + geom_bar(stat = "identity") + labs(x = "Stimuli", y = "CV", subtitle = "Performing-Articulation (Correct Answer = NO)")
```
### CV (dynamics)
```{r ioi-cv-dynamics, echo = FALSE}
# ioi-tra-dynamics
ioi_cv_dynamics <- ioi_cv[Skill == "dynamics"]

ioi_cv_dynamics$Correct <- 0
ioi_cv_dynamics[Condition == "teaching"]$Correct <- order_art[condition == "teaching"]$mean_percent
ioi_cv_dynamics[Condition == "performing"]$Correct <- order_art[condition == "performing"]$mean_percent

ggplot(ioi_cv_dynamics[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = CV, fill = Correct)) + geom_bar(stat = "identity") + labs(x = "Stimuli", y = "CV", subtitle = "Teaching-Dynamics (Correct Answer = YES)")

ggplot(ioi_cv_dynamics[Condition == "performing"], aes(x = reorder(Instance, Correct), y = CV, fill = Correct)) + geom_bar(stat = "identity") + labs(x = "Stimuli", y = "CV", subtitle = "Performing-Dynamics (Correct Answer = NO)")
```

## 2. Articulation
### Legato
```{r kot-legato, echo = FALSE}
# kot-legato
kot_legato <- kot[Subcomponent == "Legato"]

kot_legato$Correct <- 0
kot_legato[Condition == "teaching"]$Correct <- order_art[condition == "teaching"]$mean_percent
kot_legato[Condition == "performing"]$Correct <- order_art[condition == "performing"]$mean_percent

ggplot(kot_legato[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-100, 100) + labs(x = "Stimuli", y = "KOT (ms)", subtitle = "Teaching-Legato (Correct Answer = YES)")

ggplot(kot_legato[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-100, 100) + labs(x = "Stimuli", y = "KOT (ms)", subtitle = "Performing-Legato (Correct Answer = NO)")
```

### Staccato
```{r kot-staccato, echo = FALSE}
# kot-staccato
kot_staccato <- kot[Subcomponent == "Staccato"]

kot_staccato$Correct <- 0
kot_staccato[Condition == "teaching"]$Correct <- order_art[condition == "teaching"]$mean_percent
kot_staccato[Condition == "performing"]$Correct <- order_art[condition == "performing"]$mean_percent

ggplot(kot_staccato[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-200, 0) + labs(x = "Stimuli", y = "KOT (ms)", subtitle = "Teaching-Staccato (Correct Answer = YES)")

ggplot(kot_staccato[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-200, 0) + labs(x = "Stimuli", y = "KOT (ms)", subtitle = "Performing-Staccato (Correct Answer = NO)")
```

### Legato vs. Staccato
```{r leg-sta, echo = FALSE}
leg_sta <- rbind(kot_legato, kot_staccato)

ggplot(leg_sta[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct, color = Subcomponent)) + geom_bar(stat = "identity", position = position_dodge()) + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-200, 100) + labs(x = "Stimuli", y = "KOT (ms)", subtitle = "Teaching (Correct Answer = YES)")

ggplot(leg_sta[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct, color = Subcomponent)) + geom_bar(stat = "identity", position = position_dodge()) + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-200, 100) + labs(x = "Stimuli", y = "KOT (ms)", subtitle = "Performing (Correct Answer = NO)")
```

## 3. Dynamics
### Forte
```{r vel-forte, echo = FALSE}
# vel-forte
vel_forte <- vel[Subcomponent == "Forte"]

vel_forte$Correct <- 0
vel_forte[Condition == "teaching"]$Correct <- order_dyn[condition == "teaching"]$mean_percent
vel_forte[Condition == "performing"]$Correct <- order_dyn[condition == "performing"]$mean_percent

ggplot(vel_forte[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + labs(x = "Stimuli", y = "KV", subtitle = "Teaching-Forte (Correct Answer = YES)")

ggplot(vel_forte[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + labs(x = "Stimuli", y = "KV", subtitle = "Performing-Forte (Correct Answer = NO)")
```

### Piano
```{r vel-piano, echo = FALSE}
# vel-piano
vel_piano <- vel[Subcomponent == "Piano"]

vel_piano$Correct <- 0
vel_piano[Condition == "teaching"]$Correct <- order_dyn[condition == "teaching"]$mean_percent
vel_piano[Condition == "performing"]$Correct <- order_dyn[condition == "performing"]$mean_percent

ggplot(vel_piano[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 90) + labs(x = "Stimuli", y = "KV", subtitle = "Teaching-Piano (Correct Answer = YES)")

ggplot(vel_piano[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 90) + labs(x = "Stimuli", y = "KV", subtitle = "Performing-Piano (Correct Answer = NO)")
```

### Forte vs. Piano
```{r for-pia, echo = FALSE}
for_pia <- rbind(vel_forte, vel_piano)

ggplot(for_pia[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct, color = Subcomponent)) + geom_bar(stat = "identity", position = position_dodge()) + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + labs(x = "Stimuli", y = "KV", subtitle = "Teaching (Correct Answer = YES)")

ggplot(for_pia[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct, color = Subcomponent)) + geom_bar(stat = "identity", position = position_dodge()) + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + labs(x = "Stimuli", y = "KV", subtitle = "Performing (Correct Answer = NO)")
```

### Forte to Piano
```{r vel-diff-ftop, echo = FALSE}
# vel_diff-ftop
vel_diff_ftop <- vel_diff[Subcomponent == "FtoP"]

vel_diff_ftop$Correct <- 0
vel_diff_ftop[Condition == "teaching"]$Correct <- order_dyn[condition == "teaching"]$mean_percent
vel_diff_ftop[Condition == "performing"]$Correct <- order_dyn[condition == "performing"]$mean_percent

ggplot(vel_diff_ftop[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-50, 10) + labs(x = "Stimuli", y = "KV", subtitle = "Teaching-FtoP (Correct Answer = YES)")

ggplot(vel_diff_ftop[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-50, 10) + labs(x = "Stimuli", y = "KV", subtitle = "Performing-FtoP (Correct Answer = NO)")
```

### Piano to Forte
```{r vel-diff-ptof, echo = FALSE}
# vel_diff-ptof
vel_diff_ptof <- vel_diff[Subcomponent == "PtoF"]

vel_diff_ptof$Correct <- 0
vel_diff_ptof[Condition == "teaching"]$Correct <- order_dyn[condition == "teaching"]$mean_percent
vel_diff_ptof[Condition == "performing"]$Correct <- order_dyn[condition == "performing"]$mean_percent

ggplot(vel_diff_ptof[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 60) + labs(x = "Stimuli", y = "KV", subtitle = "Teaching-PtoF (Correct Answer = YES)")

ggplot(vel_diff_ptof[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct)) + geom_bar(stat = "identity") + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(0, 60) + labs(x = "Stimuli", y = "KV", subtitle = "Performing-PtoF (Correct Answer = NO)")
```

### FtoP vs. PtoF
```{r ftop-ptof, echo = FALSE}
ftop_ptof <- rbind(vel_diff_ftop, vel_diff_ptof)

ggplot(ftop_ptof[Condition == "teaching"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct, color = Subcomponent)) + geom_bar(stat = "identity", position = position_dodge()) + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-40, 45) + labs(x = "Stimuli", y = "KV", subtitle = "Teaching (Correct Answer = YES)")

ggplot(ftop_ptof[Condition == "performing"], aes(x = reorder(Instance, Correct), y = Mean, fill = Correct, color = Subcomponent)) + geom_bar(stat = "identity", position = position_dodge()) + geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD), width = .2, position = position_dodge(.9)) + ylim(-40, 45) + labs(x = "Stimuli", y = "KV", subtitle = "Performing (Correct Answer = NO)")
```
